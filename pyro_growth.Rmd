---
title: "pyro_growth"
date: "2025-12-02"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 2
    number_sections: true
    theme: united  # optional — you can pick a theme you like
    highlight: tango # optional
---

# Install packages 
```{r import packages}
library(googlesheets4) #scrapes google sheets
library(dplyr) # dataframe manipulation
library(ggplot2) # plotting package
library(lubridate)
library(tidyr)
library(readr)
library(scales)
library(growthrates) 
library(patchwork)
library(grid)
```

# Create a color pallete
```{r my palette}
pp_palette <- c(
  # Original + Extended Palette (50 colors)
  "#7D8F69", "cornflowerblue", "#F5C45E", "#C1D3D5", "plum",
  "hotpink4", "lightsalmon", "steelblue", "indianred", "springgreen4", 
   "#102E50", "maroon", "lightgreen", "lightblue", "gold",
  "#BFA5A0", "#A26769", "blue", "red", "lightpink", 
  "#71816D", "#FFE6E6", "#E5C1CD", "#A3B18A", "salmon", "magenta", "orchid","deepskyblue", "tomato",
    "cyan", "hotpink", "yellow", "orange",
   "#C0A98E", "#7A9E9F", "#A1869E", "#BFD8B8", "#F7DD72","green", "darkgreen","purple", 
  "#FFE5AD",
  "#CDB4DB"  
)
scales::show_col(pp_palette)
```

# 1. Growth of a Low-Diversity P. bahamense Isolate
# Chlorophyll-a fluorescence (RFU) data from P. bahamense cultures were used to  visualize growth patterns, quantify maximum biomass, and estimate specific growth rates under media conditions deficient in media lacking one targeted B vitamin. Specific growth rates were computed using the  “alleasy_linear” function of the “growthrates” package in R Studio (Hall et al., 2014; RStudio Team, 2020).

## Import the Dataset:
```{r import data}
fluor<-as.data.frame(read_csv("fluor.csv"))
fluor$Time <- as.numeric(sub('.', '', fluor$Time))
fluor$Date <- mdy(fluor$Date)
fluor$Time <- fluor$Time * 48 /24
```

## Visulaize growth:
```{r}
LD_OTB_all_growth <- ggplot(
 fluor %>%
    filter(
      Treatment %in% c("-Cobalamin", "Replete", "-Thiamine", "-Biotin"),
      Round %in% c(1, 2,3,4)),
  aes(x = Time, y = `Chlorophyll-A (RFU)`, color = Treatment)) +
  geom_point(size = 3)  + geom_smooth(se=FALSE)+
  # Manual color scale
  scale_color_manual(
    values = c(
      "-Cobalamin" = "#102E50",
      "Replete"    = "#F5C45E",
      "-Thiamine"  = "deeppink4",
      "-Biotin"    = "#667028"
    ),
    labels = c(
      "-Cobalamin" = expression(" —B"[12]),
      "-Thiamine"  = expression("—thiamine"),
      "-Biotin"    = expression("—biotin"),
      "Replete"    = "replete"),
    name = "Treatment") +
 labs(
    x = "Time (days)",
    y = expression(paste("Chlorophyll-", italic("a"), " fluorescence (RFU)"))
  ) +
  facet_grid(~Round) +
  theme_minimal() +
  theme(
    panel.border = element_rect(fill = NA, color = "black"),
    panel.grid = element_blank(),
    axis.title = element_text(size = 20),
    axis.text  = element_text(size = 20, color = "black"),
    strip.text = element_text(size = 20, color = "black"),
    legend.title = element_text(size = 18, color = "black"),
    legend.text  = element_text(size = 18, color = "black"),
    legend.position = "bottom",
    axis.ticks = element_line(color = "black", linewidth = 0.5),
    axis.ticks.length = unit(4, "pt")
  )

LD_OTB_all_growth
```

## Calculate maximum RFU values for each round and medium treatment
```{r max biomass}
max_bio <- fluor %>%
  filter(Round %in% c(1, 2, 3, 4)) %>%
  filter(Treatment %in% c("-Cobalamin", "Replete", "-Biotin", "-Thiamine")) %>%
  group_by(Treatment, Round, Rep) %>%
  summarise(Max_Chl = max(`Chlorophyll-A (RFU)`, na.rm = TRUE), .groups = "drop")

print(max_bio)
```

### Run an ANOVA followed by a Tukey HSD test for the treatment factor
```{r}
aov_max_bio <-  aov(Max_Chl ~ Treatment, data = max_bio)
TukeyHSD(aov_max_bio)
summary(aov_max_bio)
```

### Prepare data for plotting max biomass
```{r}
# Calculate mean and SD
summary_stats <- max_bio %>%
  group_by(Treatment, Round) %>%
  summarise(
    mean_chl = mean(Max_Chl, na.rm = TRUE),
    sd_chl   = sd(Max_Chl, na.rm = TRUE),
    .groups = "drop"
  )

# Make Treatment a factor in both datasets
max_bio$Treatment <- factor(max_bio$Treatment, 
                            levels = c( "-Biotin", "-Cobalamin","-Thiamine", "Replete"))

summary_stats$Treatment <- factor(summary_stats$Treatment, 
                                  levels = c("-Cobalamin", "-Thiamine", "-Biotin", "Replete"))

max_bio$Treatment <- factor(
  max_bio$Treatment,
  levels = c("-Cobalamin", "Replete", "-Thiamine", "-Biotin")
)

summary_stats$Treatment <- factor(
  summary_stats$Treatment,
  levels = c("-Cobalamin", "Replete", "-Thiamine", "-Biotin"))
```

### Plot maximum biomass
```{r}
max_bio_LD <- ggplot(max_bio, aes(x = Treatment, y = Max_Chl, color = Treatment)) +
  
  # Raw points (per round)
  geom_point(size = 3, shape = 16, position = position_jitter(width = 0.1)) +
  
  # Error bars: mean ± SD across replicates
  geom_errorbar(
    data = summary_stats,
    aes(
      x = Treatment,
      y = mean_chl,
      ymin = mean_chl - sd_chl,
      ymax = mean_chl + sd_chl,
      color = Treatment
    ),
    width = 0.3,
    position = position_dodge(width = 0.6),
    inherit.aes = FALSE
  ) +
  
  # Open circles for replicate-averaged means
  geom_point(
    data = summary_stats,
    aes(x = Treatment, y = mean_chl, color = Treatment),
    shape = 21,
    size = 5,
    stroke = 1.2,
    position = position_dodge(width = 0.6),
    inherit.aes = FALSE
  ) +
  
  # Labels
  labs(
    x = "Media Treatment",
    y = expression(paste("Maximum RFU"))
  ) +
  
  # Manual colors
  scale_color_manual(
    values = c(
      "-Cobalamin" = "#102E50",
      "-Thiamine"  = "deeppink4",
      "-Biotin"    = "#667028",
      "Replete"    = "#F5C45E"
    ),
    labels = c(
      "-Cobalamin" = expression("—B"[12]),
      "-Thiamine"  = expression("—Thiamine"),
      "-Biotin"    = expression("—Biotin"),
      "Replete"    = "Replete"
    ),
    name = "Treatment",
    guide = guide_legend(
      override.aes = list(
        shape = 21,
        fill  = "white",
        stroke = 1.2,
        size = 2
      )
    )
  ) +
  
  # X-axis label formatting
  scale_x_discrete(
    labels = c(
      "-Biotin"    = expression("\u2013Biotin"),
      "-Cobalamin" = expression("\u2013B"[12]),
      "-Thiamine"  = expression("\u2013Thiamine"),
      "Replete"    = "Replete"
    )
  ) +
  
  scale_y_continuous(labels = comma) +
  
  # Theme
  theme_minimal() +
  theme(
    panel.border = element_rect(fill = NA, color = "black"),
    panel.grid = element_blank(),
    axis.text.y = element_text(size = 20, color = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, size = 16, color = "black"),
  
    axis.title.y = element_text(size = 22),
    axis.title.x = element_text(size = 20, margin = margin(t = 10)),
    strip.text.x = element_text(size = 18),
    legend.title = element_text( size = 20, color = "black"),
    legend.text = element_text( size = 16, color = "black"),
    legend.position = "none",
    axis.ticks = element_line(color = "black", linewidth = 0.5),
    axis.ticks.length = unit(4, "pt")
  ) +
  guides(color = "none", fill = "none", shape = "none")+
coord_cartesian(ylim = c(0, 10000)) 

# Print plot
max_bio_LD
```
## Specific growth rates using all_easylinear

### Specific Growth Rates Biotin trial 1
```{r}
bio1 <- fluor %>%
  filter(Treatment == "-Biotin", Round %in% c(1) )%>%
  rename(Chl = `Chlorophyll-A (RFU)`) %>%
  droplevels()

bio_lin1 <- all_easylinear(Chl ~ Time|Round+Treatment+Rep, bio1, h = 7, quota = 1)

par(mfrow = c(3, 3))
par(mar = c(2, 2, 2, 1))
plot(bio_lin1, log = "y")

summary(bio_lin1)
coef(bio_lin1)
rsquared(bio_lin1)
```

### Specific Growth Rates Biotin trial 2
```{r}
bio2 <- fluor %>%
  filter(Treatment == "-Biotin", Round %in% c(2) )%>%
  rename(Chl = `Chlorophyll-A (RFU)`) %>%
  droplevels()

bio_lin2 <- all_easylinear(Chl ~ Time|Round+Treatment+Rep, bio2, h = 7, quota = 1)

par(mfrow = c(3, 3))
par(mar = c(2, 2, 2, 1))
plot(bio_lin2, log = "y")

summary(bio_lin2)
coef(bio_lin2)
rsquared(bio_lin2)
```

### Specific Growth Rates Biotin trial 3
```{r}
bio3 <- fluor %>%
  filter(Treatment == "-Biotin", Round %in% c(3) )%>%
  rename(Chl = `Chlorophyll-A (RFU)`) %>%
  droplevels()

bio_lin3 <- all_easylinear(Chl ~ Time|Round+Treatment+Rep, bio3, h = 7, quota = 1)

par(mfrow = c(3, 3))
par(mar = c(2, 2, 2, 1))
plot(bio_lin3, log = "y")

summary(bio_lin3)
coef(bio_lin3)
rsquared(bio_lin3)
```

### Specific Growth Rates Biotin trial 4
```{r}
bio4 <- fluor %>%
  filter(Treatment == "-Biotin", Round %in% c(4) )%>%
  rename(Chl = `Chlorophyll-A (RFU)`) %>%
  droplevels()

bio_lin4 <- all_easylinear(Chl ~ Time|Round+Treatment+Rep, bio4, h = 7, quota = 1)

par(mfrow = c(3, 3))
par(mar = c(2, 2, 2, 1))
plot(bio_lin4, log = "y")

summary(bio_lin4)
coef(bio_lin4)
rsquared(bio_lin4)
```

### Specific Growth Rates Thiamine trial 1
```{r}
thia1 <- fluor %>%
  filter(Treatment == "-Thiamine", Round %in% c(1) )%>%
  rename(Chl = `Chlorophyll-A (RFU)`) %>%
  droplevels()

thia_lin1 <- all_easylinear(Chl ~ Time|Round+Treatment+Rep, thia1, h = 7, quota = 1)

par(mfrow = c(3, 3))
par(mar = c(2, 2, 2, 1))
plot(thia_lin1, log = "y")

summary(thia_lin1)
coef(thia_lin1)
rsquared(thia_lin1)
```

### Specific Growth Rates Thiamine trial 2
```{r}
thia2 <- fluor %>%
  filter(Treatment == "-Thiamine", Round %in% c(2) )%>%
  rename(Chl = `Chlorophyll-A (RFU)`) %>%
  droplevels()

thia_lin2 <- all_easylinear(Chl ~ Time|Round+Treatment+Rep, thia2, h = 9, quota = 1)

par(mfrow = c(3, 3))
par(mar = c(2, 2, 2, 1))
plot(thia_lin2, log = "y")

summary(thia_lin2)
coef(thia_lin2)
rsquared(thia_lin2)
```

### Specific Growth Rates Thiamine trial 3
```{r}
thia3 <- fluor %>%
  filter(Treatment == "-Thiamine", Round %in% c(3) )%>%
  rename(Chl = `Chlorophyll-A (RFU)`) %>%
  droplevels()

thia_lin3 <- all_easylinear(Chl ~ Time|Round+Treatment+Rep, thia3, h = 9, quota = 1)

par(mfrow = c(3, 3))
par(mar = c(2, 2, 2, 1))
plot(thia_lin3, log = "y")

summary(thia_lin3)
coef(thia_lin3)
rsquared(thia_lin3)
```

### Specific Growth Rates Thiamine trial 4
```{r}
thia4 <- fluor %>%
  filter(Treatment == "-Thiamine", Round %in% c(4) )%>%
  rename(Chl = `Chlorophyll-A (RFU)`) %>%
  droplevels()

thia_lin4 <- all_easylinear(Chl ~ Time|Round+Treatment+Rep, thia4, h = 9, quota = 1)

par(mfrow = c(3, 3))
par(mar = c(2, 2, 2, 1))
plot(thia_lin4, log = "y")

summary(thia_lin4)
coef(thia_lin4)
rsquared(thia_lin4)
```

### Specific Growth Rates Replete trial 1
```{r}
rep1 <- fluor %>%
  filter(Treatment == "Replete", Round %in% c(1)) %>%
  rename(Chl = `Chlorophyll-A (RFU)`) %>%
  droplevels()

rep_lin1 <- all_easylinear(Chl ~ Time|Round+Treatment+Rep, rep1, h = 7, quota = 1)

par(mfrow = c(3, 3))
par(mar = c(2, 2, 2, 1))
plot(rep_lin1, log = "y")

summary(rep_lin1)
coef(rep_lin1)
rsquared(rep_lin1)

```

### Specific Growth Rates Replete trial 2
```{r}
rep2 <- fluor %>%
  filter(Treatment == "Replete", Round %in% c(2)) %>%
  rename(Chl = `Chlorophyll-A (RFU)`) %>%
  droplevels()

rep_lin2 <- all_easylinear(Chl ~ Time|Round+Treatment+Rep, rep2, h = 7, quota = 1)

par(mfrow = c(3, 3))
par(mar = c(2, 2, 2, 1))
plot(rep_lin2, log = "y")

summary(rep_lin2)
coef(rep_lin2)
rsquared(rep_lin2)
```

### Specific Growth Rates Replete trial 3
```{r}
rep3 <- fluor %>%
  filter(Treatment == "Replete", Round %in% c(3)) %>%
  rename(Chl = `Chlorophyll-A (RFU)`) %>%
  droplevels()

rep_lin3 <- all_easylinear(Chl ~ Time|Round+Treatment+Rep, rep3, h = 7, quota = 1)

par(mfrow = c(3, 3))
par(mar = c(2, 2, 2, 1))
plot(rep_lin3, log = "y")

summary(rep_lin3)
coef(rep_lin3)
rsquared(rep_lin3)
```
### Specific Growth Rates Replete trial 4
```{r}
rep4 <- fluor %>%
  filter(Treatment == "Replete", Round %in% c(4)) %>%
  rename(Chl = `Chlorophyll-A (RFU)`) %>%
  droplevels()

rep_lin4 <- all_easylinear(Chl ~ Time|Round+Treatment+Rep, rep4, h = 7, quota = 1)

par(mfrow = c(3, 3))
par(mar = c(2, 2, 2, 1))
plot(rep_lin4, log = "y")

summary(rep_lin4)
coef(rep_lin4)
rsquared(rep_lin4)
```

### Combine all mumax values from each treatment
```{r}
extract_results <- function(model, treatment_name) {
  coefs <- coef(model)
  r2vals <- rsquared(model)
  
  df <- as.data.frame(coefs) %>%
    tibble::rownames_to_column("Group") %>%
    mutate(
      Treatment = treatment_name,
      r2 = r2vals
    ) %>%
    # Split "Group" into Round and Rep (Group looks like "1:-Thiamine:2")
    tidyr::separate(Group, into = c("Round", "Treatment_label", "Rep"), sep = ":", remove = FALSE) %>%
    mutate(Round = as.integer(Round))
  
  return(df)
}

# --- Extract Biotin rounds ---
df_bio1 <- extract_results(bio_lin1, "-Biotin")
df_bio2 <- extract_results(bio_lin2, "-Biotin")
df_bio3 <- extract_results(bio_lin3, "-Biotin")
df_bio4 <- extract_results(bio_lin4, "-Biotin")
df_bio <- bind_rows(df_bio1, df_bio2, df_bio3, df_bio4)

# --- Extract Thiamine rounds ---
df_thia1 <- extract_results(thia_lin1, "-Thiamine")
df_thia2 <- extract_results(thia_lin2, "-Thiamine")
df_thia3 <- extract_results(thia_lin3, "-Thiamine")
df_thia4 <- extract_results(thia_lin4, "-Thiamine")
df_thia <- bind_rows(df_thia1, df_thia2, df_thia3, df_thia4)

# --- Extract Replete rounds ---
df_rep1 <- extract_results(rep_lin1, "Replete")
df_rep2 <- extract_results(rep_lin2, "Replete")
df_rep3 <- extract_results(rep_lin3, "Replete")
df_rep4 <- extract_results(rep_lin4, "Replete")
df_rep <- bind_rows(df_rep1, df_rep2, df_rep3, df_rep4)

# --- Combine all treatments ---
all_lin_results <- bind_rows(df_bio, df_thia, df_rep)

# Optional: ensure Round is treated as a factor
all_lin_results$Round <- factor(all_lin_results$Round)
```

### ANOVA and TUK HSD for specific growth rates between treatments
```{r}
all_lin_results$Round <- factor(all_lin_results$Round)
linear <- aov(mumax ~ Treatment , data = all_lin_results)
summary(linear)
TukeyHSD(linear)
```

### Plot mumaxes for Pyro grown in -Thiamine, -Biotin, and Replete 
```{r}
all_lin_results$Treatment <- factor(
  all_lin_results$Treatment,
  levels = c("-Cobalamin",  "-Thiamine", "-Biotin","Replete")
)

mu <- ggplot(all_lin_results, aes(x = Treatment, y = mumax, color = Treatment)) +
  # Raw points
  geom_point(size = 3, shape = 16, position = position_jitter(width = 0.1)) +
  # Mean ± SE
  stat_summary(fun = mean, geom = "point", shape = 1, size = 5, stroke = 1.2) +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.2) +
  scale_color_manual(values = c(
    "-Cobalamin" = "#102E50",
    "Replete"    = "#F5C45E",
    "-Thiamine"  = "deeppink4",
    "-Biotin"    = "#667028"
  )) +
  scale_x_discrete(labels = c(
    "-Cobalamin" = expression("\u2212B"[12]),
    "Replete"    = "Replete",
    "-Thiamine"  = expression("\u2212Thiamine"),
    "-Biotin"    = expression("\u2212Biotin")
  )) +
  theme_minimal() +
  theme(
    legend.position = "none",
    panel.grid = element_blank(),
    panel.border = element_rect(fill = NA, color = "black"),
    axis.title = element_text( size = 20),
    axis.text = element_text( size = 20, color = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    strip.text = element_text( size = 20, color = "black"),
    legend.title = element_blank(),
    legend.text = element_blank(),
    legend.key = element_blank()
  ) +
    labs(
      x = "Media Treatment",
      y = expression(paste("(", mu, ") RFU" * "\u00B7" * "day"^-1, " "))
    ) + guides(color = "none", fill = "none", shape = "none")

mu
```

## Figure 2
```{r}
bo <- 
  LD_OTB_all_growth / 
  (max_bio_LD +
   mu ) +
  plot_layout(guides = "collect") &
  theme(
    legend.position = "bottom",
    panel.spacing = unit(.1, "lines"),
    plot.margin = margin(15, 15, 15, 15),
    axis.title.y = element_text(margin = margin(r = 12)),
    axis.title.x = element_text(margin = margin(t = 8)),
    legend.margin = margin(t = 4, b = 4),
    legend.box.margin = margin(5, 5, 5, 5),
    axis.text.x = element_text(size = 16),
    
  )
bo
```

# P. bahamense recruitment experiments
# Low-diveristy P. bahamense culture was co-cultured with bacteria recruited from OTB (Old Tampa Bay) water, Indian River Lagoon (IRL) culture, and IRL surface seawater and grown in replete media and media missing B12

##Import data:

###OTB water
```{r}
OTB <- as.data.frame(read_sheet("https://docs.google.com/spreadsheets/d/1J7mcUc22TS7YU5_0qULqlZcLO_7sAfZMXJF4i6yO0k0/edit?gid=0#gid=0"))
OTB$Time <- as.numeric(sub('.', '', OTB$Time))
OTB$Date <- ymd(OTB$Date)
OTB$Time <- OTB$Time * 48
OTB %<>% filter(Treatment %in% c("-Cobalamin", "Replete", "-Thiamine", "-Biotin")) %>%  # Keep only desired treatments
  mutate(Treatment = factor(Treatment, levels = c("-Cobalamin", "Replete",  "-Thiamine", "-Biotin"))) %>%  # Reassign levels
  droplevels()  # Drop unused factor levels
OTB$Time_in_Days <- OTB$Time / 24  # Convert Time from hours to days
```


### IRL water
```{r}
IRLrec<-as.data.frame(read_sheet("https://docs.google.com/spreadsheets/d/14vcZcv6T1SMArRUWgZT1R-BxI_K3nnAWk3APMDTx_ws/edit?gid=0#gid=0"))
IRLrec$Time <- as.numeric(sub('.', '', IRLrec$Time))
IRLrec$Date <- ymd(IRLrec$Date)
IRLrec$Time <- IRLrec$Time * 48
IRLrec$Time_in_Days <- IRLrec$Time / 24  # Convert Time from hours to days
```


### IRL culture
```{r}
IRLcul <- as.data.frame(read_sheet("https://docs.google.com/spreadsheets/d/152LJnHlyE7BVIg4P94l_wuC2RVi7gUhj8dogtArG-kc/edit?gid=0#gid=0"))

# Remove periods and convert to numeric
IRLcul$Time <- as.numeric(gsub("\\.", "", IRLcul$Time))  # Remove all periods
# Convert Date column to Date type
IRLcul$Date <- ymd(IRLcul$Date)
IRLcul$Time <- IRLcul$Time * 48
IRLcul$Time_in_Days <- IRLcul$Time / 24 

```


#Low diveristy
```{r}
fluor<-as.data.frame(read_sheet("https://docs.google.com/spreadsheets/d/1iD3GXey2Rg31hJI7V125ByjyR8TPvAD1kbDD4dR87VE/edit?usp=sharing"))
fluor$Time <- as.numeric(sub('.', '', fluor$Time))
fluor$Date <- ymd(fluor$Date)
fluor$Time <- fluor$Time * 48

fluor$Time_in_Days <- fluor$Time / 24 
fluor <- fluor %>%
  rename(Bio_Rep = Rep)

fluor %<>% 
  filter(Treatment %in% c("-Cobalamin", "Replete", "-Thiamine", "-Biotin")) %>%  # Keep only desired treatments
  mutate(Treatment = factor(Treatment, levels = c("-Cobalamin", "Replete",  "-Thiamine", "-Biotin"))) %>%  # Reassign levels
  droplevels()  # Drop unused factor levels
```